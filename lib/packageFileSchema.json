{
    "$schema": "http://json-schema.org/draft-07/schema",
    "$id": "http://datapm.io/docs/package-file-schema-v1.json",
    "type": "object",
    "title": "DataPM Package File",
    "description": "The root definition file for version 1 of the datapm package file system.",
    "default": {},
    "required": ["updatedDate", "displayName", "packageSlug", "version", "description", "schemas"],
    "properties": {
        "generatedBy": {
            "$id": "#/generatedBy",
            "type": "string",
            "maxLength": 256,
            "title": "Generated By",
            "description": "The name of the person or system that generated the pacakge file.",
            "default": ""
        },
        "updatedDate": {
            "$id": "#/updatedDate",
            "type": "string",
            "maxLength": 128,
            "format": "date-time",
            "title": "Schema Updated Date",
            "description": "The last updated date of the package file - not the data!",
            "default": "[\\W_-]+"
        },
        "displayName": {
            "$id": "#/displayName",
            "type": "string",
            "maxLength": 128,
            "title": "User Friendly Name",
            "description": "The name shown in UI's for user ease of understanding.",
            "default": "",
            "pattern": "^[\\w _-]+$"
        },
        "packageSlug": {
            "$id": "#/packageSlug",
            "type": "string",
            "maxLength": 100,
            "title": "Short Name",
            "description": "The name used to reference this package for API and developer purposes. This field is restricted to characters A-z,0-9,_,-,@",
            "default": "",
            "pattern": "^[a-z0-9]+(?:(?:(?:[._]|__|[-]*)[a-z0-9]+)+)?$"
        },
        "version": {
            "$id": "#/version",
            "type": "string",
            "maxLength": 128,
            "title": "Version",
            "description": "In the semantic versioning format of major.minor.patch",
            "default": "1.0.0",
            "pattern": "^[0-9]+\\.[0-9]+\\.[0-9]+$"
        },
        "readmeFile": {
            "$id": "#/readmeFile",
            "type": "string",
            "maxLength": 1024,
            "title": "README File Location",
            "description": "The relative path from the package file to the markdown formated README file. Specify this instead of readmeMarkdown to manage the content in a separate file."
        },
        "readmeMarkdown": {
            "$id": "#/readmeMarkdown",
            "type": "string",
            "maxLength": 100000,
            "title": "README.md contents",
            "description": "Markdown formated README content for the package."
        },
        "licenseFile": {
            "$id": "#/licenseFile",
            "type": "string",
            "maxLength": 1024,
            "title": "LICENSE File Location",
            "description": "The relative path from the package file to the markdown formated LICENSE file. Specify this instead of licenseMarkdown to manage the content in a separate file."
        },
        "licenseMarkdown": {
            "$id": "#/licenseMarkdown",
            "type": "string",
            "maxLength": 100000,
            "title": "LICENSE.md contents",
            "description": "Markdown formated content describing the license for the schema and data in the package."
        },
        "website": {
            "$id": "#/website",
            "type": "string",
            "format": "iri",
            "maxLength": 1024,
            "title": "Website",
            "description": "The URL of the information/marketing website related to this package."
        },
        "contactEmail": {
            "$id": "#/contactEmail",
            "type": "string",
            "format": "idn-email",
            "maxLength": 1024,
            "title": "Contact Email",
            "description": "An email address for contacting the author."
        },
        "registries": {
            "$id": "#/registries",
            "type": "array",
            "title": "Registries",
            "description": "The registries to which this package file is published",
            "default": [
                {
                    "url": "https://datapm.io",
                    "pattern": "^https?:\\/\\/.*"
                }
            ],
            "required": ["hostname", "port"],
            "items": {
                "type": "object",
                "properties": {
                    "catalogSlug": {
                        "type": "string",
                        "maxLength": 38,
                        "pattern": "^[a-z0-9](?:[a-z0-9]|-(?=[a-z0-9])){0,38}$"
                    },
                    "registryURL": {
                        "type": "string",
                        "maxLength": 512
                    }
                }
            }
        },
        "description": {
            "$id": "#/description",
            "type": "string",
            "maxLength": 256,
            "title": "Package Description",
            "description": "A short description of the package contents that is shown in package listings. Use the readmeFile or readmeMark down for long form content.",
            "default": ""
        },
        "schemas": {
            "$id": "#/schemas",
            "type": "array",
            "title": "Schemas",
            "description": "A set of schemas of the data that are avialable in the package. These data types may be aquired indpenedntly, or all together - usually through multiple connections.",
            "default": [],
            "items": {
                "allOf": [
                    { "$ref": "http://json-schema.org/draft-07/schema" },
                    {
                        "type": "object",
                        "title": "Schema",
                        "description": "A schema of data available in the package. ",
                        "additionalItems": true,
                        "properties": {
                            "properties": {
                                "items": {
                                    "allOf": [
                                        { "$ref": "http://json-schema.org/draft-07/schema" },
                                        {
                                            "required": ["type"]
                                        }
                                    ]
                                }
                            },
                            "parser": {
                                "$id": "#/schemas/parser",
                                "type": "object",
                                "title": "Parser",
                                "description": "A description of the parser needed for the stream.",
                                "default": {},
                                "required": ["mimeType"],
                                "properties": {
                                    "mimeType": {
                                        "$id": "#/schemas/parser/mimeType",
                                        "type": "string",
                                        "maxLength": 128,
                                        "title": "Parser Mime Type",
                                        "description": "The mime type of the file, which identifies the parser needed.",
                                        "default": ""
                                    },
                                    "configuration": {
                                        "$id": "#/schemas/parser/configuration",
                                        "type": "object",
                                        "tile": "Parser Configuration",
                                        "description": "The parser configuration. The properties of which is specific to the parser",
                                        "properties": {},
                                        "additionalProperties": true
                                    }
                                },
                                "additionalProperties": true
                            },
                            "recordCount": {
                                "$id": "#/schemas/statistics/recordCount",
                                "type": "integer",
                                "title": "Record Count",
                                "description": "The exact or estamated number of records in the data set.",
                                "default": 0
                            },
                            "recordCountApproximate": {
                                "$id": "#/schemas/statistics/recordCountApproximate",
                                "type": "boolean",
                                "title": "Record Count Approximate",
                                "description": "Whether a record count is exact or approximate",
                                "default": false
                            },
                            "byteCount": {
                                "$id": "#/schemas/statistics/byteCount",
                                "type": "integer",
                                "title": "Byte Count",
                                "description": "The exact or approximate number of bytes in the raw dataset. This should include only the 'values' and not the format, schema, or keys",
                                "default": 0
                            },
                            "byteCountApproximate": {
                                "$id": "#/schemas/statistics/byteCountApproximate",
                                "type": "boolean",
                                "title": "Byte Count Approximate",
                                "description": "Whether the provided byte count is approximate or exact.",
                                "default": false
                            },
                            "samples": {
                                "$id": "#/sampleRecords",
                                "type": "array",
                                "title": "Samples",
                                "description": "A randomly selected set of sample reference records",
                                "default": [],
                                "items": {
                                    "type": "object"
                                }
                            },
                            "source": {
                                "$id": "#/schemas/source",
                                "type": "object",
                                "title": "Data Source",
                                "description": "A description of how the data is sourceed",
                                "default": {},
                                "required": ["protocol"],
                                "properties": {
                                    "protocol": {
                                        "$id": "#/schemas/source/protocol",
                                        "type": "string",
                                        "maxLength": 128,
                                        "title": "Source Protocol",
                                        "description": "The protocol that is used to source the data. This defines the transport method.",
                                        "default": ""
                                    },
                                    "configuration": {
                                        "$id": "#/schemas/source/configuration",
                                        "type": "object",
                                        "title": "Source Configuration",
                                        "description": "The configuration used by the transport implementation to aquire the data stream.",
                                        "default": {},
                                        "required": [],
                                        "properties": {},
                                        "additionalProperties": true
                                    }
                                },
                                "additionalProperties": true
                            }
                        }
                    }
                ]
            }
        }
    },
    "additionalProperties": true
}
