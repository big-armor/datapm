<div class="container mt-4 pt-2">
    <div class="mb-4 pb-2">
        <div class="text-main-title">Public Access</div>
        <p class="text-dark-gray col-md-8 p-0">
            Enabling public access allows all users, including anonymous users, to view these catalog details. Users
            must have access to each individual package to view them. Packages in this catalog can not be set public
            until this catalog is public.
        </p>
        <div class="d-flex align-items-center justify-content-between">
            <div class="d-flex align-items-center public-toggle">
                <div class="ml-auto pr-2 pb-1 slide-right">
                    <mat-slide-toggle
                        class="app-slide-toggle"
                        [checked]="isCatalogPublic"
                        (change)="updatePublic($event)"
                        [disabled]="!catalog.myPermissions.includes(Permission.MANAGE)"
                    ></mat-slide-toggle>
                </div>
                <div class="pr-2 text-dark-gray" style="margin-bottom: 0px !important">
                    <span class="public-text" *ngIf="isCatalogPublic">Public</span>
                    <span class="not-public-text" *ngIf="!isCatalogPublic">Not Public</span>
                </div>
            </div>
            <div *ngIf="hasCatalogPublicErrors">
                Error occurred when saving Catalog. Please refresh the page and try again.
            </div>
        </div>
    </div>

    <div class="mb-2 pb-4" *ngIf="user?.isAdmin">
        <div class="text-main-title">Unclaimed</div>
        <p class="text-dark-gray col-md-8 p-0">
            An unclaimed catalog is managed by any administrator, and is intended for the use case where the data
            originator has not claimed an account on this registry.
        </p>
        <div class="d-flex align-items-center justify-content-between">
            <div class="d-flex align-items-center public-toggle">
                <div class="ml-auto pr-2 pb-1 slide-right">
                    <mat-slide-toggle
                        class="app-slide-toggle"
                        [checked]="isCatalogUnclaimed"
                        (change)="updateUnclaimed($event)"
                    ></mat-slide-toggle>
                </div>
                <div class="pr-2 text-dark-gray" style="margin-bottom: 0px !important">
                    <span class="public-text" *ngIf="isCatalogUnclaimed">Unclaimed</span>
                    <span class="not-public-text" *ngIf="!isCatalogUnclaimed">Claimed</span>
                </div>
            </div>
            <div *ngIf="hasCatalogUnclaimedErrors">
                Error occurred when saving Catalog. Please refresh the page and try again.
            </div>
        </div>
    </div>

    <div class="text-main-title">Manage This Catalog</div>
    <a class="app-outlined-button mr-3" (click)="editCatalog()">Edit Catalog Details</a>
    <a
        class="app-outlined-button mr-3"
        (click)="deleteCatalog()"
        *ngIf="catalog.myPermissions.includes(Permission.MANAGE)"
        >Delete This Catalog</a
    >

    <div class="mt-4 py-4" *ngIf="users?.length">
        <div class="text-main-title">Users With Access</div>
        <p class="text-dark-gray">The following users have individual permission this catalog.</p>
        <button
            class="app-outlined-button"
            (click)="addUser()"
            *ngIf="users.length > 0 && catalog.myPermissions.includes(Permission.MANAGE)"
        >
            Add User
        </button>
    </div>

    <!-- Package without thumbnail -->
    <table mat-table [dataSource]="users" *ngIf="users.length > 0" class="gray-table" aria-labelledby="permissions">
        <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef scope="col">Name</th>
            <td class="table-content" mat-cell *matCellDef="let user">
                <div style="display: flex; justify-content: start; align-content: center">
                    <a class="ml-2" [routerLink]="'/' + user.username"
                        ><app-avatar [user]="user" [size]="24"></app-avatar
                    ></a>

                    <a class="color-info ml-2" [routerLink]="'/' + user.username">{{ user.name }}</a>
                    <span *ngIf="user.pendingInvitationAcceptance"> &nbsp;(pending invite acceptance)</span>
                </div>
            </td>
        </ng-container>

        <ng-container matColumnDef="permission">
            <th mat-header-cell *matHeaderCellDef scope="col">Permission</th>
            <td class="table-content" mat-cell *matCellDef="let user">
                <mat-form-field
                    appearance="fill"
                    class="permission-div"
                    *ngIf="catalog.myPermissions.includes(Permission.MANAGE)"
                >
                    <mat-select
                        [value]="user.permission"
                        (selectionChange)="updatePermission(user.username, $event.value)"
                    >
                        <mat-option value="VIEW">View </mat-option>
                        <mat-option value="EDIT">Edit </mat-option>
                        <mat-option value="MANAGE">Manage </mat-option>
                    </mat-select>
                </mat-form-field>
                <span *ngIf="!catalog.myPermissions.includes(Permission.MANAGE)">{{
                    myCatalogPermission(user.permission)
                }}</span>
            </td>
        </ng-container>

        <!-- Actions column -->
        <ng-container matColumnDef="actions" *ngIf="catalog.myPermissions.includes(Permission.MANAGE)">
            <th mat-header-cell *matHeaderCellDef scope="col">Actions</th>
            <td mat-cell *matCellDef="let user">
                <a class="app-outlined-button mr-3" (click)="removeUser(user.username)">Remove</a>
            </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="columnsToDisplay"></tr>
        <tr mat-row *matRowDef="let row; columns: columnsToDisplay"></tr>
    </table>

    <div class="dpm-no-data" *ngIf="!users.length">
        <p>There are no users who have permissions to this catalog.</p>
        <a
            class="app-outlined-button mt-3"
            (click)="addUser()"
            *ngIf="catalog.myPermissions.includes(Permission.MANAGE)"
            >Add a user</a
        >
    </div>
</div>
